# 并行编程作业二：并行化奇偶排序

# 思路

1.  进程内排序。

   ```
   Process     0         1         2         3          4           5          6           7
   Value   |6 8 3 5| |9 4 1 7| |8 2 1 7| |3 5 2 9| |8 11 4 29| |34 1 4 56| |5 7 6 11| |10 9 5 2| （排序前）
   Value   |3 5 6 8| |1 4 7 9| |1 2 7 8| |2 3 5 9| |4 8 11 29| |1 4 34 56| |5 6 7 11| |2 5 9 10| （排序后）
   ```

   

2. **【偶数阶段】** 满足 `(偶数，奇数)` 索引的相邻进程组成进程对。

   ```
   Process      0         1           2         3            4           5            6          7
   Value   (|3 5 6 8| |1 4 7 9|) (|1 2 7 8| |2 3 5 9|) (|4 8 11 29| |1 4 34 56|) (|5 6 7 11| |2 5 9 10|) 
   ```

   

3.  **【偶数阶段】** 如果偶数进程的最大值大于奇数进程的最小值，则合并、排序两个进程的序列并重新分配至进程中（元素交换）。

   ```
   Process     0           1          2         3           4           5             6          7
   Value   (|1 3 4 5   6 7 8 9|) (|1 2 2 3   5 7 8 9|) (|1 4 4 8   11 29 34 56|) (|2 5 5 6   7 9 10 11|) （合并排序）
   Value   (|1 3 4 5| |6 7 8 9|) (|1 2 2 3| |5 7 8 9|) (|1 4 4 8| |11 29 34 56|) (|2 5 5 6| |7 9 10 11|) （重新分配）
   ```

   

4. **【奇数阶段】** 满足 `(奇数，偶数)` 索引的相邻进程组成进程对。

   ```
   Process     0          1         2           3         4             5           6           7
   Value   |1 3 4 5| (|6 7 8 9| |1 2 2 3|) (|5 7 8 9| |1 4 4 8|) (|11 29 34 56| |2 5 5 6|) |7 9 10 11|
   ```

5. **【奇数阶段】** 如果奇数进程的最大值大于偶数进程的最小值，则合并、排序两个进程的序列并重新分配至进程中（元素交换）。

   ```
   Process     0          1         2           3         4           5           6             7
   Value   |1 3 4 5| (|1 2 2 3   6 7 8 9|) (|1 4 4 5   7 8 8 9|) (|2 5 5 6   11 29 34 56|) |7 9 10 11| （合并排序）
   Value   |1 3 4 5| (|1 2 2 3| |6 7 8 9|) (|1 4 4 5| |7 8 8 9|) (|2 5 5 6| |11 29 34 56|) |7 9 10 11| （重新分配）
   ```

   

6. 交替运行 **偶数阶段** 和 **奇数阶段 **总计 $n_\text{进程数}$ 次。

# 环境

```bash
ubuntu 20.04
```

## 生成数据

```bash
python3 generate.py
```
该文件生成$1e5$个随机数，保存在`result/in.txt`中。第一行是数组长度，第$2$到$n+1$行是数组；同时会生成排序正确的结果，并保存在`result/stdout.txt`中。

## 运行方法

### 编译

```bash
make
```
### 执行

```bash
mpiexec -np <进程数> ./odd_even_sort
```
在排序完成后，会将结果保存在`result/out.txt`中。


### 清理

```bash
make clean
```

## 检查正确性
`diff.py`用于检查排序结果是否正确，返回出现不同的第一行并将其输出到`result/diff.txt`中。

```bash
python3 diff.py <file1> <file2>
```
例如
```bash
python3 diff.py result/stdout.txt result/out.txt
```

## 测试不同进程数并检查正确性

```bash
bash measure.sh
```



## 本地运行结果

| 启动进程数 | 奇偶排序函数时间 (秒) |
| ---------- | :-------------------- |
| 1          | 23.0366               |
| 2          | 6.03164               |
| 3          | 2.76088               |
| 4          | 1.62661               |
| 5          | 1.13964               |
| 6          | 0.891046              |
| 7          | 0.688745              |
| 8          | 0.581191              |



> 注：测试数据量为$1e5$

乔若奕 10215101483 

